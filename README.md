Здесь размещены исходники сталкера "Тень Чернобыля" с правками, которые затрагивают только сдк.

Собранные сдк (в шапке темы): https://www.gameru.net/forum/index.php?showtopic=59990&view=findpost&p=1530012

---

## Copyright

Все правки взяты с:

https://bitbucket.org/stalker/xray-csky_borscht_sdk/
https://bitbucket.org/sv3nk/la-code/
https://github.com/OGSR/OGSR-Engine/
https://github.com/abramcumner/xray15
https://github.com/abramcumner/xray16

за что и спасибо тем людям!

---

## ИСТОРИЯ ИЗМЕНЕНИЙ:

---------------------------------------------------------------------
12.06.2022
---------------------------------------------------------------------

- Как в ЗП, при генерации аи-сетки, можно указать какие материалы объекта нужно игнорировать. Как пример, террейн (земля и прочее) с водой, добавляем water, и ноды создадутся под водой.
- Убрано авто-удаление текущих декалей с уровня, если добавить другие через Open Selection.
- Возможность изменять координаты точки пути только в режиме Point Mode.
- Поправлен баг, когда едва открыв уровень, уже имеются изменения в сцене, которые нужно сохранить перед сбросом.
- Добавлен формат 8.8.8 (без альфы) при конвертации текстур.
- Увеличен предел (до 1000000000) для массы кости в АЕ.
- Вывод в лог имя объекта, добавленный через Multiple Append. Также, при попытке удалить, если тот залочен.

---------------------------------------------------------------------
02.11.2021
---------------------------------------------------------------------

Actor Editor:
- обработка сглаживания при конвертации в OGF (как в ЗП)
- пакетное конвертирование OMF (в папке import примеры)
- дополнены подсказки к кнопкам (select, move, rotate, scale)

Level Editor:
- при удалении объекта в сцене, проверяется не залочен ли он (Locking - блокирует перемещение/вращение объекта)

---------------------------------------------------------------------
03.10.2021
---------------------------------------------------------------------

В настройки сцены добавлены параметры, которые были в старых сдк:

Hemisphere energy coeff (по-умолчанию: 2) - Amount of energy distributed across hemisphere (описание из билдов).

Jitter distortion (по-умолчанию: 0.49) - влияет на тени, которые запекаются в лайтмапы для r1. При уменьшении параметра, становятся более размытыми и наоборот.


В шейдеры компиляции, добавлен флаг Tessellate, который проверяет xrLC. В уже созданных, его нужно включить для всех шейдеров, кроме:
* те, что назначаются для лодов - машины, вагоны (def_objects_lod и т.п);
* у которых отключен флаг Rendering (не видно в игре);
* использующиеся для лестниц (def_kolizion и т.п);
* все, что в папке flora\;

После, можно сделать копию нужного шейдера с отключенной тесселяцией, чтобы применить для какого-то меша/его части. При компиляции, на стадии Adaptive HT: Tesselating, такие полигоны будут пропущены. Или использовать ключ -skip_aht_tess, чтобы вообще отключить тесселяцию.

---------------------------------------------------------------------
25.08.2021
---------------------------------------------------------------------

Исправлены критические баги при сборки спавна:
- в xrCore
- в se_zones.script (заменён на оригинальный)

---------------------------------------------------------------------
05.08.2021
---------------------------------------------------------------------

- Исправлено Make Thumbnail в АЕ.
- Кнопка Not to All для отсутствующих объектов при открытии карты.
- Добавлены thm для всех звуков, кроме тех, что в папках characters_voice\human_
- Возможность менять размер AI-ноды в ЛЕ.
- Окошко задания координат камеры.
- Сохранять настройки погоды в LE (время, таймфактор).
- Возможность использовать Sound Occlusion Model в LE. Расставить отсекатели, сделать make som, через меню Sounds загрузить level.som.
- Полноэкранный режим во всех редакторах.
- Исправлено окошко с ручной заменой отсутствующих моделей в спавн-секциях.
- Исправление мерцающей без Real time травы в ЛЕ.
- Окошко about с номером билда и ссылками на статьи / видеуроки по сдк.
- Правка вылета при выборе none анимации физического объекта.
- Флажок Normal Alignment для детейлов.
- Правка определения имени LOD-текстуры у объектов в ActorEditor.
- Отсутствие клавиши всегда свободно, чтобы можно было снимать хоткеи.
- Исправление отзеркаливания иконки на флажках в LE.
- Сохранять имя заданного трека при настройке sounv env.
- Багфикс порчи модели скайбокса для редакторов.
- Затычка от вылета при отсутствии звуковой карты или -nosound

---------------------------------------------------------------------
10.07.2021
---------------------------------------------------------------------

- В левел_эдиторе исправлен баг с выделением статичных звуков / групп (через zoom extent select).
- В компилятор добавлен флаг* -skip_optimize для пропуска фазы оптимизации, которая удаляет мелкие полигоны. Из-за этого, мелкие детали объектов корёжило или они просто удалялись.
* он также отключает проверку на инвалиды, поэтому для проверки геометрии, сперва запускать без него

- Увеличены буферы (DVB: 32768 Kb, DIB: 4096 Kb). До правки, редактор часто вылетал, если открывать много карт подряд. Также в статистику редактора добавлено отображение значений этих буферов.

---------------------------------------------------------------------
20.05.2021
---------------------------------------------------------------------

- Возможность редактировать шейп уровня (bound_rect), сохранение в level.ltx, но значение нужно скопировать в секцию уровня (game_maps_single.ltx). Также, в спавн-секциях (для которых нужен шейп), можно задать его размер ($def_sphere = 2), при расстановки таких объектов в сдк, они будут создаваться сразу с шейпом.

- Как в ЗП, привязка к секторам дополнительных карт локаций (map\map_name#0 и т.д.), которые в игре меняются. Расширено до 30 текстур. Также в секции уровня (game_maps_single.ltx) можно регулировать масштаб текстуры на миникарте: minimap_zoom = 1 ; меньше <1> больше (1.5 или 2 для подземных локации).

Эти правки затрагивают не только сдк:
https://bitbucket.org/Yar0s1av/xray_stalker_sdk_04_fixed/commits/f5ab389078090a51112dc29e97e5269fc114fd05
https://bitbucket.org/Yar0s1av/xray_stalker_sdk_04_fixed/commits/c712ea04e651c1ef67a0b978fb3cfe71c7d43e0b

---------------------------------------------------------------------
06.02.2021
---------------------------------------------------------------------

- Вернул сжатие build_details.dds в DXT1 alpha, т.к. из-за плавной альфы DXT3 теряется пышность травы.
[Убрано] Сохранять build_details.dds как DXT3
https://bitbucket.org/stalker/xray-csky_borscht_sdk/commits/89b4f1f0803e9a53855233bdfebf9b225eb56d15

- Также добавлено из зп-сдк: DialogEditor (_dialog_editor.cmd), PostprocessEditor (bins\PostprocessEditor), ScriptDebugger (_scripts_debug.cmd), и для теста - сетевой xrLC (tool_01_xrLC_net.cmd), подробнее в xrLC_net.txt.

---------------------------------------------------------------------
08.01.2021
---------------------------------------------------------------------

- Возможность одновременно запускать два и более LE (как и остальные).
- Перенесена (из ЗП-сдк) функция удаления схожих порталов в LE (remove similar).

---------------------------------------------------------------------
30.06.2020
---------------------------------------------------------------------

- Для LE сделано сохранение групп сглаживания при билде карты. Чтобы получить норм. сглаживание, нужно использовать объекты с типом сглаживания ЧН / ЗП (задаётся в плагине для майки при экспорте), иначе будут проблемы с освещением полигонов (или использовать ключ -nosmg, чтобы включить ТЧ-вариант).

- Собран ЗП-xrLC для ТЧ:
а) Чтение thm из равдаты
б) ТЧ-порядок каналов у лайтмап (в ргб - хеми, альфа - солнце)
в) Доп.ключи запуска (с https://github.com/abramcumner/xray15 / 16):

(-h для просмотра всех ключей)
-nolmaps - компил без лайтмапов
-lmap_quality число - качество лайтмапов
-lmap_rgba - использовать формат RGBA (без сжатия) для лайтмапов
-skip_aht_tess - пропустить шаг Adaptive HT Tesselating
-skip_inv_face - сообщение, вместо вылета, о наличии "неправильных" полигонов
-skip_ter_imlc - пропустить компил лайтмапа для террейна

---------------------------------------------------------------------
22.06.2020
---------------------------------------------------------------------

- Поправлены пути сохранения thm: в папку rawdata\textures. Также, они (новосозданные) пойдут для игровой геймдаты.
- THM для групп теперь сохраняются в папку groups, а не в objects
- В xrAI увеличено количество проц.потоков при компиляции аи-сетки с 3 до 8. Убран вылет (xrAI / сдк), когда инклуд-файл не найден в кастомдате спаун-элемента, но при компиле all.spawn, в логе будет имя отсутствующего файла. Только для инклудов типа: #include "scripts\name.ltx"<<END

---------------------------------------------------------------------
17.05.2020
---------------------------------------------------------------------

- Поддержка drag'n'drop в АЕ
- Флаг force 16bit motion (editor preferences > tools > motion export)
- Не выводить окошко с подтверждением после создания sky small
- Cохранять параметр Depth Tolerance (box pick in LE settings)
- Флажок вкл / выкл для отрисовки нод при генерации ИИ-сетки (при выкл, процесс идёт быстрей)
- Продолжать проигрывать анимацию частиц после изменения параметров, если была нажата кнопка Play (PE)
- Более позиция выделения в Object List не сбрасывается (LE)
- Разблокирована опция hemisphere control (по-умолчанию всегда hemi) (для ценителей статики)

---------------------------------------------------------------------
15.05.2020
---------------------------------------------------------------------

- Для всех редакторов включена поддержка LARGEADDRESSAWARE
- Исправлены диалоговые окна в редакторах под win7 / win10
- При экспорте дописывать в лог имя модели / анимации (AE)
- Отключение оптимизации скелетных мешей (AE)
- Теперь при изменении параметров костей обновляются только свойства, список не обновляется, дабы не сворачивались кости ниже выделенной (AE)
- Загрузка / сохранение списка костей в bone parts (AE)
- Не переименовать звуки в ~name.ogg при синхронизации
- fixed image editor
- Писать имя surface в лог, если назначены несовместимые шейдеры
- Сохранять build_details.dds как DXT3 [Убрано]
- Увеличение максимального размера build_details.dds до 4096x4096
- Увеличение максимального размера level_lods.dds до 4096x4096
- Исправлена ошибка, если выбрать <none> при выборе группы
- Замена простого сообщения в лог на окошко с ошибкой, при попытке добавить неправильный детальный объект
- Возможность регулировать дисперсию солнца в настройках сцены, чтобы заработали мягкие тени
- Сверх качество хемисферы в настройках сцены (hemisphere quality: 4)
- Правка ошибки при нажатии на пустоту в режиме Attach Object
- Защита от пустых параметров $spawn, они иногда могут привести к ошибкам
- Показывать имя файла объекта в сообщении, если тот не найден
- Число одновременно добавляемых объектов (до 1024, в списках, где надо ставить галки), для детальных объектов в object list - 100
- Снятие ограничения на количество валлмарков
- Текстовый редактор для снап-листа
- Не очищать snap list при выполнении Clear AI Map
- Отдельная кнопка для экспорта level.snd_env
- Форму со списком детальных объектов теперь можно растягивать в ширину, также можно регулировать ширину левой и правой её части. Высота элементов из списка регулируется колёсиком мышки.
- Сообщение вместо окна с ошибкой, при отсутствующем ANM в поле Motion (zones, heli)
- Окно с ошибкой при неверной спаун-секции
- LE при построении уровня (Compile->Build) не удаляет маленькие полигоны
- Отключение оптимизации объектов при загрузке
- Теперь масштаб объекта учитывается при проверке invalid faces
- Увеличена точность позиционирования объектов до 4 знаков после запятой. (AE, LE)
- Правка генератора разбиваемых стёкол
- Автофокусировка на некоторые окошки со списками
- Раскрывать весь свиток (список костей и т.п.) по клику с зажатой клавишей ctrl
- Правка ошибки в случае установки в ноль количества запоминаемых последних файлов (recent count)
- В режиме вращение объектов добавлено фиксированное вращение (90 градусов) с зажатым ctrl
- Сохранение вращения при перемещении объекта с привязкой Normal Aligment (from cop src)
- Убраны сообщения, типа Please notify AlexMX...
- Увеличен лимит по скорости (до 1000) в редакторах
- Увеличен лимит pixel per meter (до 100) в настройках сцены
- Поправлен экспорт DM (AE)
- В настройки LE добавлена возможность отключать сообщения в логе: CSceneObject: 'file_name' different file version!
(editors preferences -> objects -> loading -> Check file version)
- Добавлен ключ для запуска редакторов: -dbg_log
(детальное логирование - ид загруженных/отсутствующих текстур, звуков с данными для АИ)
